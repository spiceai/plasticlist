version: v1beta1
kind: Spicepod
name: plasticlist

datasets:
  # - from: https://www.plasticlist.org/downloads/samples.tsv
  #   name: samples
  #   description: plasticlist.org samples dataset (2024) accelerated with Spice
  #   acceleration:
  #     enabled: true

  - from: file:///Users/lukim/Downloads/samples.tsv
    name: samples
    description: plasticlist.org samples dataset (2024)
    metadata:
      instructions: |
        The `samples` dataset contains a list of samples from plasticlist.org.
      reference_url_template: https://www.plasticlist.org/product/<product_id>

    columns:
      - name: id
        description: Sample unique ID
      - name: product
        description: The product tested including brand, name, and description
        embeddings:
          - from: openai_embeddings
            row_id: product_id
      - name: tags
        description: Tags associated with the product
      - name: DEHP_equivalents_ng_g
        description: Bis(2-ethylhexyl) phthalate (DEHP) equivalents in ng/g
      - name: DEHP_ng_g
        description: Bis(2-ethylhexyl) phthalate (DEHP) in ng/g
      - name: DBP_ng_g
        description: Dibutyl phthalate (DBP) in ng/g
      - name: BBP_ng_g
        description: Benzyl butyl phthalate (BBP) in ng/g
      - name: DIBP_ng_g
        description: Diisobutyl phthalate (DIBP) in ng/g
      - name: DINP_ng_g
        description: Diisononyl phthalate (DINP) in ng/g
      - name: DIDP_ng_g
        description: Diisodecyl phthalate (DIDP) in ng/g
      - name: BPA_ng_g
        description: Bisphenol A (BPA) in ng/g
      - name: BPS_ng_g
        description: Bisphenol S (BPS) in ng/g

models:
  - from: openai:gpt-4o
    name: gpt4o
    description: OpenAI GPT-4o model
    params:
      tools: auto, memory
      openai_api_key: ${ secrets:OPENAI_API_KEY }
      system_prompt: |
        You are an AI assistant created by Spice AI (spice.ai) helping a user with a question about plastic chemicals in food products based on the plasticlist.org `samples` dataset.

        Always be specific and provide the data in answers.

        When referencing products, favor the aggregate of samples for each unique product and provide the plasticlist.org URL as a citation.

        ## Attribution
        PlasticList. 'Data on Plastic Chemicals in Bay Area Foods'. plasticlist.org. Accessed Dec 31, 2024.

embeddings:
  - from: openai
    name: openai_embeddings
    params:
      openai_api_key: ${ secrets:OPENAI_API_KEY }
    datasets:
      - samples
